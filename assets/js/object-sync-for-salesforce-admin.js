'use strict';

var $ = window.jQuery;

function salesforce_object_fields() {
	if ($('.salesforce_record_types_allowed > *').length === 0) {
		$('.salesforce_record_types_allowed').hide();
	}
	if ($('.salesforce_record_type_default > *').length === 0) {
		$('.salesforce_record_type_default').hide();
	}
	if ($('.pull_trigger_field > *').length === 0) {
		$('.pull_trigger_field').hide();
	}

	var delay = function () {
		var timer = 0;
		return function (callback, ms) {
			clearTimeout(timer);
			timer = setTimeout(callback, ms);
		};
	}();

	$('#salesforce_object').on('change', function (el) {
		var that = this;
		var delay_time = 1000;
		delay(function () {
			var data = {
				'action': 'get_salesforce_object_description',
				'include': ['fields', 'recordTypeInfos'],
				'field_type': 'datetime',
				'salesforce_object': that.value
			};
			$.post(ajaxurl, data, function (response) {

				var record_types_allowed_markup = '',
				    record_type_default_markup = '',
				    date_markup = '';

				if ($(response.data.recordTypeInfos).length > 0) {
					record_types_allowed_markup += '<label for="salesforce_record_types_allowed">Allowed Record Types:</label><div class="checkboxes">';
					$.each(response.data.recordTypeInfos, function (index, value) {
						record_types_allowed_markup += '<label><input type="checkbox" class="form-checkbox" value="' + index + '" name="salesforce_record_types_allowed[' + index + ']" id="salesforce_record_types_allowed-' + index + '"> ' + value + '</label>';
					});
					record_types_allowed_markup += '</div>';

					record_type_default_markup += '<label for="salesforce_record_type_default">Default Record Type:</label>';
					record_type_default_markup += '<select name="salesforce_record_type_default" id="salesforce_record_type_default"><option value="">- Select record type -</option>';
					$.each(response.data.recordTypeInfos, function (index, value) {
						record_type_default_markup += '<option value="' + index + '">' + value + '</option>';
					});
				}

				$('.salesforce_record_types_allowed').html(record_types_allowed_markup);
				$('.salesforce_record_type_default').html(record_type_default_markup);

				if ($(response.data.fields).length > 0) {
					date_markup += '<label for="pull_trigger_field">Date field to trigger pull:</label>';
					date_markup += '<select name="pull_trigger_field" id="pull_trigger_field"><option value="">- Select date field -</option>';
					$.each(response.data.fields, function (index, value) {
						date_markup += '<option value="' + value.name + '">' + value.label + '</option>';
					});
					date_markup += '</select>';
					date_markup += '<p class="description">These are date fields that can cause WordPress to pull an update from Salesforce, according to the <code>salesforce_pull</code> class.</p>';
				}

				$('.pull_trigger_field').html(date_markup);

				if (record_types_allowed_markup !== '') {
					$('.salesforce_record_types_allowed').show();
				} else {
					$('.salesforce_record_types_allowed').hide();
				}
				if (record_type_default_markup !== '') {
					$('.salesforce_record_type_default').show();
				} else {
					$('.salesforce_record_type_default').hide();
				}

				if (date_markup !== '') {
					$('.pull_trigger_field').show();
				} else {
					$('.pull_trigger_field').hide();
				}
			});
		}, delay_time);
	});
}

function add_field_mapping_row() {
	$('#add-field-mapping').click(function () {
		$(this).text('Add another field mapping');
		var salesforce_object = $('#salesforce_object').val();
		var wordpress_object = $('#wordpress_object').val();
		if (wordpress_object !== '' && salesforce_object !== '') {
			var row_count = $('table.fields tbody tr').length;
			fieldmap_fields(wordpress_object, salesforce_object, row_count);
			$(this).parent().find('.missing-object').remove();
		} else {
			$(this).parent().prepend('<div class="error missing-object"><span>You have to pick a WordPress object and a Salesforce object to add field mapping.</span></div>');
		}
		return false;
	});
}

function fieldmap_fields(wordpress_object, salesforce_object, row_count) {
	var data = {
		'action': 'get_wp_sf_object_fields',
		'wordpress_object': wordpress_object,
		'salesforce_object': salesforce_object
	};
	$.post(ajaxurl, data, function (response) {

		var wordpress = '';
		wordpress += '<select name="wordpress_field[' + row_count + ']" id="wordpress_field-' + row_count + '">';
		wordpress += '<option value="">- Select WordPress field -</option>';
		$.each(response.data.wordpress, function (index, value) {
			wordpress += '<option value="' + value.key + '">' + value.key + '</option>';
		});
		wordpress += '</select>';

		var salesforce = '';
		salesforce += '<select name="salesforce_field[' + row_count + ']" id="salesforce_field-' + row_count + '">';
		salesforce += '<option value="">- Select Salesforce field -</option>';
		$.each(response.data.salesforce, function (index, value) {
			salesforce += '<option value="' + value.name + '">' + value.label + '</option>';
		});
		salesforce += '</select>';

		var markup = '<tr><td class="column-wordpress_field">' + wordpress + '</td><td class="column-salesforce_field">' + salesforce + '</td><td class="column-is_prematch"><input type="checkbox" name="is_prematch[' + row_count + ']" id="is_prematch-' + row_count + '" value="1" /><td class="column-is_key"><input type="checkbox" name="is_key[' + row_count + ']" id="is_key-' + row_count + '" value="1" /></td><td class="column-direction"><div class="radios"><label><input type="radio" value="sf_wp" name="direction[' + row_count + ']" id="direction-' + row_count + '-sf-wp">  Salesforce to WordPress</label><label><input type="radio" value="wp_sf" name="direction[' + row_count + ']" id="direction-' + row_count + '-wp-sf">  WordPress to Salesforce</label><label><input type="radio" value="sync" name="direction[' + row_count + ']" id="direction-' + row_count + '-sync" checked>  Sync</label></div></td><td class="column-is_delete"><input type="checkbox" name="is_delete[' + row_count + ']" id="is_delete-' + row_count + '" value="1" /></td></tr>';
		$('table.fields tbody').append(markup);
	});
}

function push_and_pull_objects() {
	$('.salesforce_user_ajax_message').hide();
	if ($('#wordpress_object_ajax').length > 0) {
		$('.push_to_salesforce_button').on('click', function () {
			var wordpress_object = $('#wordpress_object_ajax').val();
			var wordpress_id = $('#wordpress_id_ajax').val();
			var data = {
				'action': 'push_to_salesforce',
				'wordpress_object': wordpress_object,
				'wordpress_id': wordpress_id
			};
			$.post(ajaxurl, data, function (response) {
				if (response.success === true) {
					update_salesforce_user_summary();
					$('.salesforce_user_ajax_message').width($('.mapped-salesforce-user').width() - 27);
					$('.salesforce_user_ajax_message').html('<p>This object has been pushed to Salesforce.</p>').fadeIn().delay(4000).fadeOut();
				}
			});
			return false;
		});
	}
	$('.pull_from_salesforce_button').on('click', function () {
		var salesforce_id = $('#salesforce_id_ajax').val();
		var wordpress_object = $('#wordpress_object_ajax').val();
		var data = {
			'action': 'pull_from_salesforce',
			'salesforce_id': salesforce_id,
			'wordpress_object': wordpress_object
		};
		$.post(ajaxurl, data, function (response) {
			if (response.success === true) {
				update_salesforce_user_summary();
				$('.salesforce_user_ajax_message').width($('.mapped-salesforce-user').width() - 27);
				$('.salesforce_user_ajax_message').html('<p>This object has been pulled from Salesforce.</p>').fadeIn().delay(4000).fadeOut();
			}
		});
		return false;
	});
}

function update_salesforce_user_summary() {
	var mapping_id = $('#mapping_id_ajax').val();
	var data = {
		'action': 'refresh_mapped_data',
		'mapping_id': mapping_id
	};
	$.post(ajaxurl, data, function (response) {
		if (response.success === true) {
			$('td.last_sync_message').text(response.data.last_sync_message);
			$('td.last_sync_action').text(response.data.last_sync_action);
			$('td.last_sync_status').text(response.data.last_sync_status);
			$('td.last_sync').text(response.data.last_sync);
			if (response.data.last_sync_status === '1') {
				$('td.last_sync_status').text('success');
			}
		}
	});
}

// as the drupal plugin does, we only allow one field to be a prematch or key
$(document).on('click', '.column-is_prematch input', function () {
	$('.column-is_prematch input').not(this).prop('checked', false);
});

$(document).on('click', '.column-is_key input', function () {
	$('.column-is_key input').not(this).prop('checked', false);
});

$(document).ready(function () {

	var timeout;
	$('#wordpress_object, #salesforce_object').on('change', function () {
		clearTimeout(timeout);
		timeout = setTimeout(function () {
			$('table.fields tbody tr').fadeOut();
			$('table.fields tbody tr').remove();
		}, 1000);
	});

	// todo: need to fix this so it doesn't run all the spinners at the same time when there are multiples on the same page
	$(document).ajaxStart(function () {
		$('.spinner').addClass('is-active');
	}).ajaxStop(function () {
		$('.spinner').removeClass('is-active');
	});
	salesforce_object_fields();
	add_field_mapping_row();
	push_and_pull_objects();
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkbWluLmpzIl0sIm5hbWVzIjpbIiQiLCJ3aW5kb3ciLCJqUXVlcnkiLCJzYWxlc2ZvcmNlX29iamVjdF9maWVsZHMiLCJsZW5ndGgiLCJoaWRlIiwiZGVsYXkiLCJ0aW1lciIsImNhbGxiYWNrIiwibXMiLCJjbGVhclRpbWVvdXQiLCJzZXRUaW1lb3V0Iiwib24iLCJlbCIsInRoYXQiLCJkZWxheV90aW1lIiwiZGF0YSIsInZhbHVlIiwicG9zdCIsImFqYXh1cmwiLCJyZXNwb25zZSIsInJlY29yZF90eXBlc19hbGxvd2VkX21hcmt1cCIsInJlY29yZF90eXBlX2RlZmF1bHRfbWFya3VwIiwiZGF0ZV9tYXJrdXAiLCJyZWNvcmRUeXBlSW5mb3MiLCJlYWNoIiwiaW5kZXgiLCJodG1sIiwiZmllbGRzIiwibmFtZSIsImxhYmVsIiwic2hvdyIsImFkZF9maWVsZF9tYXBwaW5nX3JvdyIsImNsaWNrIiwidGV4dCIsInNhbGVzZm9yY2Vfb2JqZWN0IiwidmFsIiwid29yZHByZXNzX29iamVjdCIsInJvd19jb3VudCIsImZpZWxkbWFwX2ZpZWxkcyIsInBhcmVudCIsImZpbmQiLCJyZW1vdmUiLCJwcmVwZW5kIiwid29yZHByZXNzIiwia2V5Iiwic2FsZXNmb3JjZSIsIm1hcmt1cCIsImFwcGVuZCIsInB1c2hfYW5kX3B1bGxfb2JqZWN0cyIsIndvcmRwcmVzc19pZCIsInN1Y2Nlc3MiLCJ1cGRhdGVfc2FsZXNmb3JjZV91c2VyX3N1bW1hcnkiLCJ3aWR0aCIsImZhZGVJbiIsImZhZGVPdXQiLCJzYWxlc2ZvcmNlX2lkIiwibWFwcGluZ19pZCIsImxhc3Rfc3luY19tZXNzYWdlIiwibGFzdF9zeW5jX2FjdGlvbiIsImxhc3Rfc3luY19zdGF0dXMiLCJsYXN0X3N5bmMiLCJkb2N1bWVudCIsIm5vdCIsInByb3AiLCJyZWFkeSIsInRpbWVvdXQiLCJhamF4U3RhcnQiLCJhZGRDbGFzcyIsImFqYXhTdG9wIiwicmVtb3ZlQ2xhc3MiXSwibWFwcGluZ3MiOiI7O0FB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SUMsT0FBSjtBQUNBbEUsR0FBRSx1Q0FBRixFQUEyQ1ksRUFBM0MsQ0FBOEMsUUFBOUMsRUFBd0QsWUFBVztBQUNsRUYsZUFBYXdELE9BQWI7QUFDQUEsWUFBVXZELFdBQVcsWUFBVztBQUMvQlgsS0FBRSx1QkFBRixFQUEyQnVELE9BQTNCO0FBQ0F2RCxLQUFFLHVCQUFGLEVBQTJCMEMsTUFBM0I7QUFDQSxHQUhTLEVBR1AsSUFITyxDQUFWO0FBSUEsRUFORDs7QUFRQTtBQUNBMUMsR0FBRThELFFBQUYsRUFBWUssU0FBWixDQUFzQixZQUFVO0FBQy9CbkUsSUFBRSxVQUFGLEVBQWNvRSxRQUFkLENBQXVCLFdBQXZCO0FBQ0EsRUFGRCxFQUVHQyxRQUZILENBRVksWUFBVztBQUN0QnJFLElBQUUsVUFBRixFQUFjc0UsV0FBZCxDQUEwQixXQUExQjtBQUNBLEVBSkQ7QUFLQW5FO0FBQ0E2QjtBQUNBaUI7QUFDQSxDQXBCRCIsImZpbGUiOiJvYmplY3Qtc3luYy1mb3Itc2FsZXNmb3JjZS1hZG1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciAkID0gd2luZG93LmpRdWVyeTtcblxuZnVuY3Rpb24gc2FsZXNmb3JjZV9vYmplY3RfZmllbGRzKCkge1xuXHRpZiAoJCgnLnNhbGVzZm9yY2VfcmVjb3JkX3R5cGVzX2FsbG93ZWQgPiAqJykubGVuZ3RoID09PSAwKSB7XG5cdFx0JCgnLnNhbGVzZm9yY2VfcmVjb3JkX3R5cGVzX2FsbG93ZWQnKS5oaWRlKCk7XG5cdH1cblx0aWYgKCQoJy5zYWxlc2ZvcmNlX3JlY29yZF90eXBlX2RlZmF1bHQgPiAqJykubGVuZ3RoID09PSAwKSB7XG5cdFx0JCgnLnNhbGVzZm9yY2VfcmVjb3JkX3R5cGVfZGVmYXVsdCcpLmhpZGUoKTtcblx0fVxuXHRpZiAoJCgnLnB1bGxfdHJpZ2dlcl9maWVsZCA+IConKS5sZW5ndGggPT09IDApIHtcblx0XHQkKCcucHVsbF90cmlnZ2VyX2ZpZWxkJykuaGlkZSgpO1xuXHR9XG5cblx0dmFyIGRlbGF5ID0gKGZ1bmN0aW9uKCl7XG5cdCAgdmFyIHRpbWVyID0gMDtcblx0ICByZXR1cm4gZnVuY3Rpb24oY2FsbGJhY2ssIG1zKXtcblx0ICAgIGNsZWFyVGltZW91dCAodGltZXIpO1xuXHQgICAgdGltZXIgPSBzZXRUaW1lb3V0KGNhbGxiYWNrLCBtcyk7XG5cdCAgfTtcblx0fSkoKTtcblxuXHQkKCcjc2FsZXNmb3JjZV9vYmplY3QnKS5vbignY2hhbmdlJywgZnVuY3Rpb24oZWwpIHtcblx0XHR2YXIgdGhhdCA9IHRoaXM7XG5cdFx0dmFyIGRlbGF5X3RpbWUgPSAxMDAwO1xuXHRcdGRlbGF5KGZ1bmN0aW9uKCl7XG5cdFx0XHR2YXIgZGF0YSA9IHtcblx0XHRcdFx0J2FjdGlvbicgOiAnZ2V0X3NhbGVzZm9yY2Vfb2JqZWN0X2Rlc2NyaXB0aW9uJyxcblx0XHRcdFx0J2luY2x1ZGUnIDogWydmaWVsZHMnLCAncmVjb3JkVHlwZUluZm9zJ10sXG5cdFx0XHRcdCdmaWVsZF90eXBlJyA6ICdkYXRldGltZScsXG5cdFx0XHRcdCdzYWxlc2ZvcmNlX29iamVjdCcgOiB0aGF0LnZhbHVlXG5cdFx0XHR9XG5cdFx0XHQkLnBvc3QoYWpheHVybCwgZGF0YSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcblxuXHRcdFx0XHR2YXIgcmVjb3JkX3R5cGVzX2FsbG93ZWRfbWFya3VwID0gJycsIHJlY29yZF90eXBlX2RlZmF1bHRfbWFya3VwID0gJycsIGRhdGVfbWFya3VwID0gJyc7XG5cblx0XHRcdFx0aWYgKCQocmVzcG9uc2UuZGF0YS5yZWNvcmRUeXBlSW5mb3MpLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0XHRyZWNvcmRfdHlwZXNfYWxsb3dlZF9tYXJrdXAgKz0gJzxsYWJlbCBmb3I9XCJzYWxlc2ZvcmNlX3JlY29yZF90eXBlc19hbGxvd2VkXCI+QWxsb3dlZCBSZWNvcmQgVHlwZXM6PC9sYWJlbD48ZGl2IGNsYXNzPVwiY2hlY2tib3hlc1wiPic7XG5cdFx0XHRcdFx0JC5lYWNoKHJlc3BvbnNlLmRhdGEucmVjb3JkVHlwZUluZm9zLCBmdW5jdGlvbihpbmRleCwgdmFsdWUpIHtcblx0XHRcdFx0XHRcdHJlY29yZF90eXBlc19hbGxvd2VkX21hcmt1cCArPSAnPGxhYmVsPjxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIiBjbGFzcz1cImZvcm0tY2hlY2tib3hcIiB2YWx1ZT1cIicgKyBpbmRleCArICdcIiBuYW1lPVwic2FsZXNmb3JjZV9yZWNvcmRfdHlwZXNfYWxsb3dlZFsnICsgaW5kZXggKyAnXVwiIGlkPVwic2FsZXNmb3JjZV9yZWNvcmRfdHlwZXNfYWxsb3dlZC0nICsgaW5kZXggKyAnXCI+ICcgKyB2YWx1ZSArICc8L2xhYmVsPic7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0cmVjb3JkX3R5cGVzX2FsbG93ZWRfbWFya3VwICs9ICc8L2Rpdj4nO1xuXG5cblx0XHRcdFx0XHRyZWNvcmRfdHlwZV9kZWZhdWx0X21hcmt1cCArPSAnPGxhYmVsIGZvcj1cInNhbGVzZm9yY2VfcmVjb3JkX3R5cGVfZGVmYXVsdFwiPkRlZmF1bHQgUmVjb3JkIFR5cGU6PC9sYWJlbD4nO1xuXHRcdFx0XHRcdHJlY29yZF90eXBlX2RlZmF1bHRfbWFya3VwICs9ICc8c2VsZWN0IG5hbWU9XCJzYWxlc2ZvcmNlX3JlY29yZF90eXBlX2RlZmF1bHRcIiBpZD1cInNhbGVzZm9yY2VfcmVjb3JkX3R5cGVfZGVmYXVsdFwiPjxvcHRpb24gdmFsdWU9XCJcIj4tIFNlbGVjdCByZWNvcmQgdHlwZSAtPC9vcHRpb24+Jztcblx0XHRcdFx0XHQkLmVhY2gocmVzcG9uc2UuZGF0YS5yZWNvcmRUeXBlSW5mb3MsIGZ1bmN0aW9uKGluZGV4LCB2YWx1ZSkge1xuXHRcdFx0XHRcdFx0cmVjb3JkX3R5cGVfZGVmYXVsdF9tYXJrdXAgKz0gJzxvcHRpb24gdmFsdWU9XCInICsgaW5kZXggKyAnXCI+JyArIHZhbHVlICsgJzwvb3B0aW9uPic7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQkKCcuc2FsZXNmb3JjZV9yZWNvcmRfdHlwZXNfYWxsb3dlZCcpLmh0bWwocmVjb3JkX3R5cGVzX2FsbG93ZWRfbWFya3VwKTtcblx0XHRcdFx0JCgnLnNhbGVzZm9yY2VfcmVjb3JkX3R5cGVfZGVmYXVsdCcpLmh0bWwocmVjb3JkX3R5cGVfZGVmYXVsdF9tYXJrdXApO1xuXG5cdFx0XHRcdGlmICgkKHJlc3BvbnNlLmRhdGEuZmllbGRzKS5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdFx0ZGF0ZV9tYXJrdXAgKz0gJzxsYWJlbCBmb3I9XCJwdWxsX3RyaWdnZXJfZmllbGRcIj5EYXRlIGZpZWxkIHRvIHRyaWdnZXIgcHVsbDo8L2xhYmVsPic7XG5cdFx0XHRcdFx0ZGF0ZV9tYXJrdXAgKz0gJzxzZWxlY3QgbmFtZT1cInB1bGxfdHJpZ2dlcl9maWVsZFwiIGlkPVwicHVsbF90cmlnZ2VyX2ZpZWxkXCI+PG9wdGlvbiB2YWx1ZT1cIlwiPi0gU2VsZWN0IGRhdGUgZmllbGQgLTwvb3B0aW9uPidcblx0XHRcdFx0XHQkLmVhY2gocmVzcG9uc2UuZGF0YS5maWVsZHMsIGZ1bmN0aW9uKGluZGV4LCB2YWx1ZSkge1xuXHRcdFx0XHRcdFx0ZGF0ZV9tYXJrdXAgKz0gJzxvcHRpb24gdmFsdWU9XCInICsgdmFsdWUubmFtZSArICdcIj4nICsgdmFsdWUubGFiZWwgKyAnPC9vcHRpb24+Jztcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRkYXRlX21hcmt1cCArPSAnPC9zZWxlY3Q+Jztcblx0XHRcdFx0XHRkYXRlX21hcmt1cCArPSAnPHAgY2xhc3M9XCJkZXNjcmlwdGlvblwiPlRoZXNlIGFyZSBkYXRlIGZpZWxkcyB0aGF0IGNhbiBjYXVzZSBXb3JkUHJlc3MgdG8gcHVsbCBhbiB1cGRhdGUgZnJvbSBTYWxlc2ZvcmNlLCBhY2NvcmRpbmcgdG8gdGhlIDxjb2RlPnNhbGVzZm9yY2VfcHVsbDwvY29kZT4gY2xhc3MuPC9wPidcblx0XHRcdFx0fVxuXG5cdFx0XHRcdCQoJy5wdWxsX3RyaWdnZXJfZmllbGQnKS5odG1sKGRhdGVfbWFya3VwKTtcblxuXHRcdFx0XHRpZiAocmVjb3JkX3R5cGVzX2FsbG93ZWRfbWFya3VwICE9PSAnJykge1xuXHRcdFx0XHRcdCQoJy5zYWxlc2ZvcmNlX3JlY29yZF90eXBlc19hbGxvd2VkJykuc2hvdygpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdCQoJy5zYWxlc2ZvcmNlX3JlY29yZF90eXBlc19hbGxvd2VkJykuaGlkZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmIChyZWNvcmRfdHlwZV9kZWZhdWx0X21hcmt1cCAhPT0gJycpIHtcblx0XHRcdFx0XHQkKCcuc2FsZXNmb3JjZV9yZWNvcmRfdHlwZV9kZWZhdWx0Jykuc2hvdygpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdCQoJy5zYWxlc2ZvcmNlX3JlY29yZF90eXBlX2RlZmF1bHQnKS5oaWRlKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoZGF0ZV9tYXJrdXAgIT09ICcnKSB7XG5cdFx0XHRcdFx0JCgnLnB1bGxfdHJpZ2dlcl9maWVsZCcpLnNob3coKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQkKCcucHVsbF90cmlnZ2VyX2ZpZWxkJykuaGlkZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9LCBkZWxheV90aW1lICk7XG5cdH0pO1xufVxuXG5mdW5jdGlvbiBhZGRfZmllbGRfbWFwcGluZ19yb3coKSB7XG5cdCQoJyNhZGQtZmllbGQtbWFwcGluZycpLmNsaWNrKGZ1bmN0aW9uKCkge1xuXHRcdCQodGhpcykudGV4dCgnQWRkIGFub3RoZXIgZmllbGQgbWFwcGluZycpO1xuXHRcdHZhciBzYWxlc2ZvcmNlX29iamVjdCA9ICQoJyNzYWxlc2ZvcmNlX29iamVjdCcpLnZhbCgpO1xuXHRcdHZhciB3b3JkcHJlc3Nfb2JqZWN0ID0gJCgnI3dvcmRwcmVzc19vYmplY3QnKS52YWwoKTtcblx0XHRpZiAod29yZHByZXNzX29iamVjdCAhPT0gJycgJiYgc2FsZXNmb3JjZV9vYmplY3QgIT09ICcnKSB7XG5cdFx0XHR2YXIgcm93X2NvdW50ID0gJCgndGFibGUuZmllbGRzIHRib2R5IHRyJykubGVuZ3RoO1x0XHRcdFx0XG5cdFx0XHRmaWVsZG1hcF9maWVsZHMod29yZHByZXNzX29iamVjdCwgc2FsZXNmb3JjZV9vYmplY3QsIHJvd19jb3VudCk7XG5cdFx0XHQkKHRoaXMpLnBhcmVudCgpLmZpbmQoJy5taXNzaW5nLW9iamVjdCcpLnJlbW92ZSgpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQkKHRoaXMpLnBhcmVudCgpLnByZXBlbmQoJzxkaXYgY2xhc3M9XCJlcnJvciBtaXNzaW5nLW9iamVjdFwiPjxzcGFuPllvdSBoYXZlIHRvIHBpY2sgYSBXb3JkUHJlc3Mgb2JqZWN0IGFuZCBhIFNhbGVzZm9yY2Ugb2JqZWN0IHRvIGFkZCBmaWVsZCBtYXBwaW5nLjwvc3Bhbj48L2Rpdj4nKTtcblx0XHR9XG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9KTtcbn1cblxuXG5mdW5jdGlvbiBmaWVsZG1hcF9maWVsZHMod29yZHByZXNzX29iamVjdCwgc2FsZXNmb3JjZV9vYmplY3QsIHJvd19jb3VudCkge1xuXHR2YXIgZGF0YSA9IHtcblx0XHQnYWN0aW9uJyA6ICdnZXRfd3Bfc2Zfb2JqZWN0X2ZpZWxkcycsXG5cdFx0J3dvcmRwcmVzc19vYmplY3QnIDogd29yZHByZXNzX29iamVjdCxcblx0XHQnc2FsZXNmb3JjZV9vYmplY3QnIDogc2FsZXNmb3JjZV9vYmplY3Rcblx0fVxuXHQkLnBvc3QoYWpheHVybCwgZGF0YSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcblxuXHRcdHZhciB3b3JkcHJlc3MgPSAnJztcblx0XHR3b3JkcHJlc3MgKz0gJzxzZWxlY3QgbmFtZT1cIndvcmRwcmVzc19maWVsZFsnICsgcm93X2NvdW50ICsgJ11cIiBpZD1cIndvcmRwcmVzc19maWVsZC0nICsgcm93X2NvdW50ICsgJ1wiPidcblx0XHR3b3JkcHJlc3MgKz0gJzxvcHRpb24gdmFsdWU9XCJcIj4tIFNlbGVjdCBXb3JkUHJlc3MgZmllbGQgLTwvb3B0aW9uPic7XG5cdFx0JC5lYWNoKHJlc3BvbnNlLmRhdGEud29yZHByZXNzLCBmdW5jdGlvbihpbmRleCwgdmFsdWUpIHtcblx0XHRcdHdvcmRwcmVzcyArPSAnPG9wdGlvbiB2YWx1ZT1cIicgKyB2YWx1ZS5rZXkgKyAnXCI+JyArIHZhbHVlLmtleSArICc8L29wdGlvbj4nO1xuXHRcdH0pO1xuXHRcdHdvcmRwcmVzcyArPSAnPC9zZWxlY3Q+JztcblxuXHRcdHZhciBzYWxlc2ZvcmNlID0gJyc7XG5cdFx0c2FsZXNmb3JjZSArPSAnPHNlbGVjdCBuYW1lPVwic2FsZXNmb3JjZV9maWVsZFsnICsgcm93X2NvdW50ICsgJ11cIiBpZD1cInNhbGVzZm9yY2VfZmllbGQtJyArIHJvd19jb3VudCArICdcIj4nXG5cdFx0c2FsZXNmb3JjZSArPSAnPG9wdGlvbiB2YWx1ZT1cIlwiPi0gU2VsZWN0IFNhbGVzZm9yY2UgZmllbGQgLTwvb3B0aW9uPic7XG5cdFx0JC5lYWNoKHJlc3BvbnNlLmRhdGEuc2FsZXNmb3JjZSwgZnVuY3Rpb24oaW5kZXgsIHZhbHVlKSB7XG5cdFx0XHRzYWxlc2ZvcmNlICs9ICc8b3B0aW9uIHZhbHVlPVwiJyArIHZhbHVlLm5hbWUgKyAnXCI+JyArIHZhbHVlLmxhYmVsICsgJzwvb3B0aW9uPic7XG5cdFx0fSk7XG5cdFx0c2FsZXNmb3JjZSArPSAnPC9zZWxlY3Q+JztcblxuXHRcdHZhciBtYXJrdXAgPSAnPHRyPjx0ZCBjbGFzcz1cImNvbHVtbi13b3JkcHJlc3NfZmllbGRcIj4nICsgd29yZHByZXNzICsgJzwvdGQ+PHRkIGNsYXNzPVwiY29sdW1uLXNhbGVzZm9yY2VfZmllbGRcIj4nICsgc2FsZXNmb3JjZSArICc8L3RkPjx0ZCBjbGFzcz1cImNvbHVtbi1pc19wcmVtYXRjaFwiPjxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIiBuYW1lPVwiaXNfcHJlbWF0Y2hbJyArIHJvd19jb3VudCArICddXCIgaWQ9XCJpc19wcmVtYXRjaC0nICsgcm93X2NvdW50ICsgJ1wiIHZhbHVlPVwiMVwiIC8+PHRkIGNsYXNzPVwiY29sdW1uLWlzX2tleVwiPjxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIiBuYW1lPVwiaXNfa2V5WycgKyByb3dfY291bnQgKyAnXVwiIGlkPVwiaXNfa2V5LScgKyByb3dfY291bnQgKyAnXCIgdmFsdWU9XCIxXCIgLz48L3RkPjx0ZCBjbGFzcz1cImNvbHVtbi1kaXJlY3Rpb25cIj48ZGl2IGNsYXNzPVwicmFkaW9zXCI+PGxhYmVsPjxpbnB1dCB0eXBlPVwicmFkaW9cIiB2YWx1ZT1cInNmX3dwXCIgbmFtZT1cImRpcmVjdGlvblsnICsgcm93X2NvdW50ICsgJ11cIiBpZD1cImRpcmVjdGlvbi0nICsgcm93X2NvdW50ICsgJy1zZi13cFwiPiAgU2FsZXNmb3JjZSB0byBXb3JkUHJlc3M8L2xhYmVsPjxsYWJlbD48aW5wdXQgdHlwZT1cInJhZGlvXCIgdmFsdWU9XCJ3cF9zZlwiIG5hbWU9XCJkaXJlY3Rpb25bJyArIHJvd19jb3VudCArICddXCIgaWQ9XCJkaXJlY3Rpb24tJyArIHJvd19jb3VudCArICctd3Atc2ZcIj4gIFdvcmRQcmVzcyB0byBTYWxlc2ZvcmNlPC9sYWJlbD48bGFiZWw+PGlucHV0IHR5cGU9XCJyYWRpb1wiIHZhbHVlPVwic3luY1wiIG5hbWU9XCJkaXJlY3Rpb25bJyArIHJvd19jb3VudCArICddXCIgaWQ9XCJkaXJlY3Rpb24tJyArIHJvd19jb3VudCArICctc3luY1wiIGNoZWNrZWQ+ICBTeW5jPC9sYWJlbD48L2Rpdj48L3RkPjx0ZCBjbGFzcz1cImNvbHVtbi1pc19kZWxldGVcIj48aW5wdXQgdHlwZT1cImNoZWNrYm94XCIgbmFtZT1cImlzX2RlbGV0ZVsnICsgcm93X2NvdW50ICsgJ11cIiBpZD1cImlzX2RlbGV0ZS0nICsgcm93X2NvdW50ICsgJ1wiIHZhbHVlPVwiMVwiIC8+PC90ZD48L3RyPic7XG5cdFx0JCgndGFibGUuZmllbGRzIHRib2R5JykuYXBwZW5kKG1hcmt1cCk7XG5cblx0fSk7XG59XG5cbmZ1bmN0aW9uIHB1c2hfYW5kX3B1bGxfb2JqZWN0cygpIHtcblx0JCgnLnNhbGVzZm9yY2VfdXNlcl9hamF4X21lc3NhZ2UnKS5oaWRlKCk7XG5cdGlmICgkKCcjd29yZHByZXNzX29iamVjdF9hamF4JykubGVuZ3RoID4gMCkge1xuXHRcdCQoJy5wdXNoX3RvX3NhbGVzZm9yY2VfYnV0dG9uJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgd29yZHByZXNzX29iamVjdCA9ICQoJyN3b3JkcHJlc3Nfb2JqZWN0X2FqYXgnKS52YWwoKTtcblx0XHRcdHZhciB3b3JkcHJlc3NfaWQgPSAkKCcjd29yZHByZXNzX2lkX2FqYXgnKS52YWwoKTtcblx0XHRcdHZhciBkYXRhID0ge1xuXHRcdFx0XHQnYWN0aW9uJyA6ICdwdXNoX3RvX3NhbGVzZm9yY2UnLFxuXHRcdFx0XHQnd29yZHByZXNzX29iamVjdCcgOiB3b3JkcHJlc3Nfb2JqZWN0LFxuXHRcdFx0XHQnd29yZHByZXNzX2lkJyA6IHdvcmRwcmVzc19pZFxuXHRcdFx0fVxuXHRcdFx0JC5wb3N0KGFqYXh1cmwsIGRhdGEsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cdFx0XHRcdGlmIChyZXNwb25zZS5zdWNjZXNzID09PSB0cnVlKSB7XG5cdFx0XHRcdFx0dXBkYXRlX3NhbGVzZm9yY2VfdXNlcl9zdW1tYXJ5KCk7XG5cdFx0XHRcdFx0JCgnLnNhbGVzZm9yY2VfdXNlcl9hamF4X21lc3NhZ2UnKS53aWR0aCgkKCcubWFwcGVkLXNhbGVzZm9yY2UtdXNlcicpLndpZHRoKCkgLSAyNyk7XG5cdFx0XHRcdFx0JCgnLnNhbGVzZm9yY2VfdXNlcl9hamF4X21lc3NhZ2UnKS5odG1sKCc8cD5UaGlzIG9iamVjdCBoYXMgYmVlbiBwdXNoZWQgdG8gU2FsZXNmb3JjZS48L3A+JykuZmFkZUluKCkuZGVsYXkoNDAwMCkuZmFkZU91dCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9KTtcblx0fVxuXHQkKCcucHVsbF9mcm9tX3NhbGVzZm9yY2VfYnV0dG9uJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG5cdFx0dmFyIHNhbGVzZm9yY2VfaWQgPSAkKCcjc2FsZXNmb3JjZV9pZF9hamF4JykudmFsKCk7XG5cdFx0dmFyIHdvcmRwcmVzc19vYmplY3QgPSAkKCcjd29yZHByZXNzX29iamVjdF9hamF4JykudmFsKCk7XG5cdFx0dmFyIGRhdGEgPSB7XG5cdFx0XHQnYWN0aW9uJyA6ICdwdWxsX2Zyb21fc2FsZXNmb3JjZScsXG5cdFx0XHQnc2FsZXNmb3JjZV9pZCcgOiBzYWxlc2ZvcmNlX2lkLFxuXHRcdFx0J3dvcmRwcmVzc19vYmplY3QnIDogd29yZHByZXNzX29iamVjdFxuXHRcdH1cblx0XHQkLnBvc3QoYWpheHVybCwgZGF0YSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdGlmIChyZXNwb25zZS5zdWNjZXNzID09PSB0cnVlKSB7XG5cdFx0XHRcdHVwZGF0ZV9zYWxlc2ZvcmNlX3VzZXJfc3VtbWFyeSgpO1xuXHRcdFx0XHQkKCcuc2FsZXNmb3JjZV91c2VyX2FqYXhfbWVzc2FnZScpLndpZHRoKCQoJy5tYXBwZWQtc2FsZXNmb3JjZS11c2VyJykud2lkdGgoKSAtIDI3KTtcblx0XHRcdFx0JCgnLnNhbGVzZm9yY2VfdXNlcl9hamF4X21lc3NhZ2UnKS5odG1sKCc8cD5UaGlzIG9iamVjdCBoYXMgYmVlbiBwdWxsZWQgZnJvbSBTYWxlc2ZvcmNlLjwvcD4nKS5mYWRlSW4oKS5kZWxheSg0MDAwKS5mYWRlT3V0KCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9KTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlX3NhbGVzZm9yY2VfdXNlcl9zdW1tYXJ5KCkge1xuXHR2YXIgbWFwcGluZ19pZCA9ICQoJyNtYXBwaW5nX2lkX2FqYXgnKS52YWwoKTtcblx0dmFyIGRhdGEgPSB7XG5cdFx0J2FjdGlvbicgOiAncmVmcmVzaF9tYXBwZWRfZGF0YScsXG5cdFx0J21hcHBpbmdfaWQnIDogbWFwcGluZ19pZFxuXHR9XG5cdCQucG9zdChhamF4dXJsLCBkYXRhLCBmdW5jdGlvbihyZXNwb25zZSkge1xuXHRcdGlmIChyZXNwb25zZS5zdWNjZXNzID09PSB0cnVlKSB7XG5cdFx0XHQkKCd0ZC5sYXN0X3N5bmNfbWVzc2FnZScpLnRleHQocmVzcG9uc2UuZGF0YS5sYXN0X3N5bmNfbWVzc2FnZSk7XG5cdFx0XHQkKCd0ZC5sYXN0X3N5bmNfYWN0aW9uJykudGV4dChyZXNwb25zZS5kYXRhLmxhc3Rfc3luY19hY3Rpb24pO1xuXHRcdFx0JCgndGQubGFzdF9zeW5jX3N0YXR1cycpLnRleHQocmVzcG9uc2UuZGF0YS5sYXN0X3N5bmNfc3RhdHVzKTtcblx0XHRcdCQoJ3RkLmxhc3Rfc3luYycpLnRleHQocmVzcG9uc2UuZGF0YS5sYXN0X3N5bmMpO1xuXHRcdFx0aWYgKHJlc3BvbnNlLmRhdGEubGFzdF9zeW5jX3N0YXR1cyA9PT0gJzEnKSB7XG5cdFx0XHRcdCQoJ3RkLmxhc3Rfc3luY19zdGF0dXMnKS50ZXh0KCdzdWNjZXNzJyk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcbn1cblxuLy8gYXMgdGhlIGRydXBhbCBwbHVnaW4gZG9lcywgd2Ugb25seSBhbGxvdyBvbmUgZmllbGQgdG8gYmUgYSBwcmVtYXRjaCBvciBrZXlcbiQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuY29sdW1uLWlzX3ByZW1hdGNoIGlucHV0JywgZnVuY3Rpb24oKSB7XG5cdCQoJy5jb2x1bW4taXNfcHJlbWF0Y2ggaW5wdXQnKS5ub3QodGhpcykucHJvcCgnY2hlY2tlZCcsIGZhbHNlKTsgIFxufSk7XG5cbiQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuY29sdW1uLWlzX2tleSBpbnB1dCcsIGZ1bmN0aW9uKCkge1xuXHQkKCcuY29sdW1uLWlzX2tleSBpbnB1dCcpLm5vdCh0aGlzKS5wcm9wKCdjaGVja2VkJywgZmFsc2UpOyAgXG59KTtcblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XG5cblx0dmFyIHRpbWVvdXQ7XG5cdCQoJyN3b3JkcHJlc3Nfb2JqZWN0LCAjc2FsZXNmb3JjZV9vYmplY3QnKS5vbignY2hhbmdlJywgZnVuY3Rpb24oKSB7XG5cdFx0Y2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuXHRcdHRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuXHRcdFx0JCgndGFibGUuZmllbGRzIHRib2R5IHRyJykuZmFkZU91dCgpO1xuXHRcdFx0JCgndGFibGUuZmllbGRzIHRib2R5IHRyJykucmVtb3ZlKCk7XG5cdFx0fSwgMTAwMCk7XG5cdH0pO1xuXG5cdC8vIHRvZG86IG5lZWQgdG8gZml4IHRoaXMgc28gaXQgZG9lc24ndCBydW4gYWxsIHRoZSBzcGlubmVycyBhdCB0aGUgc2FtZSB0aW1lIHdoZW4gdGhlcmUgYXJlIG11bHRpcGxlcyBvbiB0aGUgc2FtZSBwYWdlXG5cdCQoZG9jdW1lbnQpLmFqYXhTdGFydChmdW5jdGlvbigpe1xuXHRcdCQoJy5zcGlubmVyJykuYWRkQ2xhc3MoJ2lzLWFjdGl2ZScpO1xuXHR9KS5hamF4U3RvcChmdW5jdGlvbigpIHtcblx0XHQkKCcuc3Bpbm5lcicpLnJlbW92ZUNsYXNzKCdpcy1hY3RpdmUnKTtcblx0fSk7XG5cdHNhbGVzZm9yY2Vfb2JqZWN0X2ZpZWxkcygpO1xuXHRhZGRfZmllbGRfbWFwcGluZ19yb3coKTtcblx0cHVzaF9hbmRfcHVsbF9vYmplY3RzKCk7XG59KTsiXX0=
